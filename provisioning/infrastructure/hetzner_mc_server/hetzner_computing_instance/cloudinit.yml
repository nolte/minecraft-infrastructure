#cloud-config

package_upgrade: true

packages:
  - git
  - python-netaddr
  - firewalld

groups:
  - master-users
  - machine-users
  - ssh-users

users:
  - name: nolte
    gecos: Private User
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups:
      - ssh-users
      - master-users
    ssh_authorized_keys:
     - "${ssh_private_key_id}"
  - name: ansible
    gecos: Ansible Machine User
    primary_group: machine-users
    groups:
      - ssh-users
    ssh_authorized_keys:
     - "${ssh_machine_key_id}"

write_files:
  - path: /etc/ssh/sshd_config
    permissions: 0600
    owner: root:root
    content: |
      HostKey /etc/ssh/ssh_host_rsa_key
      HostKey /etc/ssh/ssh_host_ecdsa_key
      HostKey /etc/ssh/ssh_host_ed25519_key
      SyslogFacility AUTHPRIV
      AuthorizedKeysFile .ssh/authorized_keys
      PasswordAuthentication no
      ChallengeResponseAuthentication no
      # GSSAPI options
      GSSAPIAuthentication yes
      GSSAPICleanupCredentials no
      UsePAM yes
      X11Forwarding no
      # Accept locale-related environment variables
      AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
      AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
      AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
      AcceptEnv XMODIFIERS
      # override default of no subsystems
      Subsystem sftp	/usr/libexec/openssh/sftp-server

      PermitRootLogin no
      AllowGroups ssh-users
      StrictModes yes
      Protocol 2
